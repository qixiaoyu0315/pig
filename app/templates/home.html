{% extends "admin_layout.html" %}

{% block title %}首页 - 母猪管理系统{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">欢迎使用母猪管理系统</h4>
                <p class="card-text">本系统用于帮助养猪场管理人员高效地管理母猪繁育、饲养和健康状况。</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>猪只数量</span>
                <a href="/pig/management" class="btn btn-sm btn-outline-primary">查看详情</a>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 mb-0">{{ total_pigs }}</h1>
                <small class="text-muted">正常饲养中的母猪数量</small>
                <div class="mt-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>怀孕母猪</span>
                        <span>{{ pregnant_pigs }}</span>
                    </div>
                    <div class="progress mb-3" style="height: 5px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {% if total_pigs > 0 %}{{ (pregnant_pigs / total_pigs * 100)|round(1) }}{% else %}0{% endif %}%;" aria-valuenow="{{ pregnant_pigs }}" aria-valuemin="0" aria-valuemax="{{ total_pigs }}"></div>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>哺乳母猪</span>
                        <span>{{ nursing_pigs }}</span>
                    </div>
                    <div class="progress mb-3" style="height: 5px;">
                        <div class="progress-bar bg-info" role="progressbar" style="width: {% if total_pigs > 0 %}{{ (nursing_pigs / total_pigs * 100)|round(1) }}{% else %}0{% endif %}%;" aria-valuenow="{{ nursing_pigs }}" aria-valuemin="0" aria-valuemax="{{ total_pigs }}"></div>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>空怀母猪</span>
                        <span>{{ empty_pigs }}</span>
                    </div>
                    <div class="progress" style="height: 5px;">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: {% if total_pigs > 0 %}{{ (empty_pigs / total_pigs * 100)|round(1) }}{% else %}0{% endif %}%;" aria-valuenow="{{ empty_pigs }}" aria-valuemin="0" aria-valuemax="{{ total_pigs }}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>饲料消耗</span>
                <a href="/pig/feeding" class="btn btn-sm btn-outline-primary">查看详情</a>
            </div>
            <div class="card-body">
                <h3 class="text-center mb-4">今日消耗：{{ today_feed|round(1) }} kg</h3>
                <div class="d-flex justify-content-between mb-1">
                    <span>本周消耗</span>
                    <span>{{ week_feed|round(1) }} kg</span>
                </div>
                <div class="progress mb-3" style="height: 5px;">
                    <div class="progress-bar" role="progressbar" style="width: {% if week_feed > 0 %}{{ (today_feed / week_feed * 100)|round(1) }}{% else %}0{% endif %}%;" aria-valuenow="{{ today_feed }}" aria-valuemin="0" aria-valuemax="{{ week_feed }}"></div>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span>本月消耗</span>
                    <span>{{ month_feed|round(1) }} kg</span>
                </div>
                <div class="progress" style="height: 5px;">
                    <div class="progress-bar" role="progressbar" style="width: {% if month_feed > 0 %}{{ (week_feed / month_feed * 100)|round(1) }}{% else %}0{% endif %}%;" aria-valuenow="{{ week_feed }}" aria-valuemin="0" aria-valuemax="{{ month_feed }}"></div>
                </div>
                
                <div class="mt-4">
                    <h5 class="text-center mb-3">剩余饲料</h5>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 68%;" aria-valuenow="68" aria-valuemin="0" aria-valuemax="100">{{ remaining_feed }} kg</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>健康状况</span>
                <a href="/pig/alerts" class="btn btn-sm btn-outline-primary">查看报警</a>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 mb-4">
                        <div class="border rounded p-3">
                            <h3 class="text-success">{{ healthy_pigs }}</h3>
                            <small class="text-muted">健康</small>
                        </div>
                    </div>
                    <div class="col-6 mb-4">
                        <div class="border rounded p-3">
                            <h3 class="text-warning">{{ observe_pigs }}</h3>
                            <small class="text-muted">待观察</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3">
                            <h3 class="text-danger">{{ treating_pigs }}</h3>
                            <small class="text-muted">需治疗</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3">
                            <h3>{{ isolated_pigs }}</h3>
                            <small class="text-muted">隔离</small>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h5 class="text-center mb-3">近期报警</h5>
                    {% if recent_alerts %}
                        {% for alert in recent_alerts %}
                            <div class="alert alert-{{ 'danger' if alert.alert_level == '紧急' else ('warning' if alert.alert_level == '重要' else 'info') }} mb-2 py-2">
                                <small><strong>{{ alert.alert_type }}</strong> - {{ alert.location }} ({{ (alert.alert_time|string).split('.')[0] }})</small>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-success mb-0 py-2">
                            <small>当前没有需要处理的报警</small>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                最近活动
            </div>
            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>时间</th>
                            <th>活动类型</th>
                            <th>猪只编号</th>
                            <th>操作人员</th>
                            <th>详情</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if recent_activities %}
                            {% for activity in recent_activities %}
                                <tr>
                                    <td>{{ (activity.time|string).split('.')[0] }}</td>
                                    <td>{{ activity.type }}</td>
                                    <td>{{ activity.subject }}</td>
                                    <td>{{ activity.operator }}</td>
                                    <td>{{ activity.details }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" class="text-center">暂无活动记录</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <div class="card-footer">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">下一页</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>
{% endblock %} 